name: Persistent RDP (Public IP, No Save)

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */6 * * *"

jobs:
  rdp:
    runs-on: windows-latest
    timeout-minutes: 1440

    steps:
      # ØªÙØ¹ÙŠÙ„ RDP ÙˆØ­Ø³Ø§Ø¨ Ø¯Ø§Ø¦Ù…
      - name: Enable RDP and Persistent Account
        run: |
          $username = "PersistentRDP"
          $password = "admin@123"

          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\' -name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

          if (-not (Get-LocalUser -Name $username -ErrorAction SilentlyContinue)) {
              New-LocalUser -Name $username -Password (ConvertTo-SecureString $password -AsPlainText -Force) -AccountNeverExpires
              Add-LocalGroupMember -Group "Administrators" -Member $username
              Add-LocalGroupMember -Group "Remote Desktop Users" -Member $username
          }

      # Ø¬Ù„Ø¨ IP Ø§Ù„Ø¹Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
      - name: Get Public IP
        run: |
          $publicIP = (Invoke-WebRequest -Uri "http://ifconfig.me/ip").Content.Trim()

          Write-Host "============================="
          Write-Host "âœ… RDP Info"
          Write-Host "Public IP: $publicIP"
          Write-Host "Username: PersistentRDP"
          Write-Host "Password: admin@123"
          Write-Host "============================="

      # Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø©
      - name: Keep Workflow Alive
        run: |
          Write-Host "ğŸ’» RDP is running. Keeping session alive..."
          while ($true) {
              Start-Sleep -Seconds 300
          }
